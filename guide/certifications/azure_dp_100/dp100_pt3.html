<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Azure DP-100 Day 3 | Juan Daza</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
    <link rel="manifest" href="/favicons/site.webmanifest">
    <meta name="description" content="Personal Site - Data Science">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.da19ff51.css" as="style"><link rel="preload" href="/assets/js/app.03c7e310.js" as="script"><link rel="preload" href="/assets/js/2.13746587.js" as="script"><link rel="preload" href="/assets/js/50.a2925b36.js" as="script"><link rel="prefetch" href="/assets/js/10.6e64db09.js"><link rel="prefetch" href="/assets/js/11.f8eef57f.js"><link rel="prefetch" href="/assets/js/12.932bf117.js"><link rel="prefetch" href="/assets/js/13.af5ec17b.js"><link rel="prefetch" href="/assets/js/14.90887f5c.js"><link rel="prefetch" href="/assets/js/15.0656ff01.js"><link rel="prefetch" href="/assets/js/16.5378deca.js"><link rel="prefetch" href="/assets/js/17.19cf949a.js"><link rel="prefetch" href="/assets/js/18.0b93ce25.js"><link rel="prefetch" href="/assets/js/19.d2a95a5f.js"><link rel="prefetch" href="/assets/js/20.3747b15e.js"><link rel="prefetch" href="/assets/js/21.09f71f18.js"><link rel="prefetch" href="/assets/js/22.1b203797.js"><link rel="prefetch" href="/assets/js/23.f00a4904.js"><link rel="prefetch" href="/assets/js/24.55c27684.js"><link rel="prefetch" href="/assets/js/25.cc9485cf.js"><link rel="prefetch" href="/assets/js/26.b6b4be9f.js"><link rel="prefetch" href="/assets/js/27.c3ccad43.js"><link rel="prefetch" href="/assets/js/28.7dba3f1f.js"><link rel="prefetch" href="/assets/js/29.d10e2ae2.js"><link rel="prefetch" href="/assets/js/3.e45ecd79.js"><link rel="prefetch" href="/assets/js/30.297f8b43.js"><link rel="prefetch" href="/assets/js/31.059fac00.js"><link rel="prefetch" href="/assets/js/32.fe286e98.js"><link rel="prefetch" href="/assets/js/33.a05ae6b9.js"><link rel="prefetch" href="/assets/js/34.a9907b4b.js"><link rel="prefetch" href="/assets/js/35.00dbd65e.js"><link rel="prefetch" href="/assets/js/36.7525b75e.js"><link rel="prefetch" href="/assets/js/37.76c42826.js"><link rel="prefetch" href="/assets/js/38.434bc5a3.js"><link rel="prefetch" href="/assets/js/39.9926f29d.js"><link rel="prefetch" href="/assets/js/4.a2075b22.js"><link rel="prefetch" href="/assets/js/40.a42a18c2.js"><link rel="prefetch" href="/assets/js/41.11e8fde4.js"><link rel="prefetch" href="/assets/js/42.50ba5353.js"><link rel="prefetch" href="/assets/js/43.fb9b871b.js"><link rel="prefetch" href="/assets/js/44.3f1129f7.js"><link rel="prefetch" href="/assets/js/45.cb9a04f8.js"><link rel="prefetch" href="/assets/js/46.a950db31.js"><link rel="prefetch" href="/assets/js/47.423a39f6.js"><link rel="prefetch" href="/assets/js/48.6058c53e.js"><link rel="prefetch" href="/assets/js/49.fb478904.js"><link rel="prefetch" href="/assets/js/5.430021b0.js"><link rel="prefetch" href="/assets/js/51.14b850cb.js"><link rel="prefetch" href="/assets/js/52.49d7d515.js"><link rel="prefetch" href="/assets/js/53.a7ae275d.js"><link rel="prefetch" href="/assets/js/54.2d483aad.js"><link rel="prefetch" href="/assets/js/55.389cd245.js"><link rel="prefetch" href="/assets/js/56.6a4143ea.js"><link rel="prefetch" href="/assets/js/57.644b37c2.js"><link rel="prefetch" href="/assets/js/58.d14d7ddb.js"><link rel="prefetch" href="/assets/js/59.0fced584.js"><link rel="prefetch" href="/assets/js/6.4b7d3f73.js"><link rel="prefetch" href="/assets/js/60.fc728a42.js"><link rel="prefetch" href="/assets/js/61.b850c2ed.js"><link rel="prefetch" href="/assets/js/62.185c1619.js"><link rel="prefetch" href="/assets/js/63.de0c58b4.js"><link rel="prefetch" href="/assets/js/64.8bcc14f0.js"><link rel="prefetch" href="/assets/js/65.8aa9f5f3.js"><link rel="prefetch" href="/assets/js/66.19b23477.js"><link rel="prefetch" href="/assets/js/67.c2be4ff0.js"><link rel="prefetch" href="/assets/js/68.385aae7b.js"><link rel="prefetch" href="/assets/js/69.d49b1c21.js"><link rel="prefetch" href="/assets/js/7.0fef1f7f.js"><link rel="prefetch" href="/assets/js/70.30097da3.js"><link rel="prefetch" href="/assets/js/71.8d819576.js"><link rel="prefetch" href="/assets/js/72.27171cc5.js"><link rel="prefetch" href="/assets/js/73.661d24ab.js"><link rel="prefetch" href="/assets/js/74.58e2afb6.js"><link rel="prefetch" href="/assets/js/75.2876aa7f.js"><link rel="prefetch" href="/assets/js/8.7a3b2944.js"><link rel="prefetch" href="/assets/js/9.ad82a640.js">
    <link rel="stylesheet" href="/assets/css/0.styles.da19ff51.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/photo.png" alt="Juan Daza" class="logo"> <span class="site-name can-hide">Juan Daza</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/home.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/cv.html" class="nav-link">
  CV
</a></div><div class="nav-item"><a href="https://www.linkedin.com/in/juandanieldaza" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/home.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/cv.html" class="nav-link">
  CV
</a></div><div class="nav-item"><a href="https://www.linkedin.com/in/juandanieldaza" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LinkedIn
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">Home</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Help Snippets</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/guide/algos/" class="sidebar-link">Machine Learning</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Machine Learning</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Graphs</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/guide/mlops/" class="sidebar-link">ML OPS</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Ml Ops</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/guide/databricks/" class="sidebar-link">Databricks</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Databricks</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="azure-dp-100-day-3"><a href="#azure-dp-100-day-3" class="header-anchor">#</a> Azure DP-100 Day 3</h1> <h2 id="deploying-and-consuming-models"><a href="#deploying-and-consuming-models" class="header-anchor">#</a> Deploying and Consuming Models</h2> <p><code>Inferencing</code> refers to the use of a trained model to predict labels for new data on which the model has not been trained. In Azure Machine learning, you can create real-time inferencing solutions by deploying a model in a containerized platform such as <code>Azure Kubernetes Services (AKS)</code>.</p> <h3 id="deploying-a-service"><a href="#deploying-a-service" class="header-anchor">#</a> Deploying a Service</h3> <p>You can deploy a model as a real-time web service to the following compute targets:</p> <div class="language- extra-class"><pre><code>* local compute
* an Azure Machine Learning compute instance
* an Azure Container Instance (ACI)
* an Azure Kubernetes Service (AKS) cluster
* an Azure Function
* an Internet of Things (IoT) module. 
</code></pre></div><p>Azure Machine Learning uses containers as a deployment mechanism, packaging the model and the code to use it as an image that can be deployed to a container in your chosen compute target.</p> <p>To Deploy a model:</p> <ol><li>Register a trained model using the <code>register</code> method</li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>core <span class="token keyword">import</span> Model

classification_model <span class="token operator">=</span> Model<span class="token punctuation">.</span>register<span class="token punctuation">(</span>workspace<span class="token operator">=</span>ws<span class="token punctuation">,</span>
                       model_name<span class="token operator">=</span><span class="token string">'classification_model'</span><span class="token punctuation">,</span>
                       model_path<span class="token operator">=</span><span class="token string">'model.pkl'</span><span class="token punctuation">,</span> <span class="token comment"># local path</span>
                       description<span class="token operator">=</span><span class="token string">'A classification model'</span><span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>Define Inference Configuration</li></ol> <p>A model is composed of <code>a script to load the model</code> and <code>an environment</code>.</p> <h4 id="entry-script"><a href="#entry-script" class="header-anchor">#</a> Entry Script</h4> <p>The <code>entry script</code> must contain:</p> <div class="language- extra-class"><pre><code>*init()
*run(raw_data)
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> json
<span class="token keyword">import</span> joblib
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> azureml<span class="token punctuation">.</span>core<span class="token punctuation">.</span>model <span class="token keyword">import</span> Model

<span class="token comment"># Called when the service is loaded</span>
<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> model
    <span class="token comment"># Get the path to the registered model file and load it</span>
    model_path <span class="token operator">=</span> Model<span class="token punctuation">.</span>get_model_path<span class="token punctuation">(</span><span class="token string">'classification_model'</span><span class="token punctuation">)</span>
    model <span class="token operator">=</span> joblib<span class="token punctuation">.</span>load<span class="token punctuation">(</span>model_path<span class="token punctuation">)</span>

<span class="token comment"># Called when a request is received</span>
<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>raw_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># Get the input data as a numpy array</span>
    data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>raw_data<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># Get a prediction from the model</span>
    predictions <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment"># Return the predictions as any JSON serializable format</span>
    <span class="token keyword">return</span> predictions<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="creating-an-environment"><a href="#creating-an-environment" class="header-anchor">#</a> Creating an Environment</h4> <p>It is possible use a <code>CondaDependencies</code> class to create a default environment, you can then add any other required packages, and then serialize the environment to a string and save it.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>core<span class="token punctuation">.</span>conda_dependencies <span class="token keyword">import</span> CondaDependencies

<span class="token comment"># Add the dependencies for your model</span>
myenv <span class="token operator">=</span> CondaDependencies<span class="token punctuation">(</span><span class="token punctuation">)</span>
myenv<span class="token punctuation">.</span>add_conda_package<span class="token punctuation">(</span><span class="token string">&quot;scikit-learn&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># Save the environment config as a .yml file</span>
env_file <span class="token operator">=</span> <span class="token string">'service_files/env.yml'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>env_file<span class="token punctuation">,</span><span class="token string">&quot;w&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>myenv<span class="token punctuation">.</span>serialize_to_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&quot;Saved dependency info in&quot;</span><span class="token punctuation">,</span> env_file<span class="token punctuation">)</span>
</code></pre></div><p>Then both script and config file can be added into one script:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>core<span class="token punctuation">.</span>model <span class="token keyword">import</span> InferenceConfig

classifier_inference_config <span class="token operator">=</span> InferenceConfig<span class="token punctuation">(</span>runtime<span class="token operator">=</span> <span class="token string">&quot;python&quot;</span><span class="token punctuation">,</span>
                                              source_directory <span class="token operator">=</span> <span class="token string">'service_files'</span><span class="token punctuation">,</span>
                                              entry_script<span class="token operator">=</span><span class="token string">&quot;score.py&quot;</span><span class="token punctuation">,</span>
                                              conda_file<span class="token operator">=</span><span class="token string">&quot;env.yml&quot;</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>Define a Deployment Configuration</li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compute <span class="token keyword">import</span> ComputeTarget<span class="token punctuation">,</span> AksCompute

cluster_name <span class="token operator">=</span> <span class="token string">'aks-cluster'</span>
compute_config <span class="token operator">=</span> AksCompute<span class="token punctuation">.</span>provisioning_configuration<span class="token punctuation">(</span>location<span class="token operator">=</span><span class="token string">'eastus'</span><span class="token punctuation">)</span>
production_cluster <span class="token operator">=</span> ComputeTarget<span class="token punctuation">.</span>create<span class="token punctuation">(</span>ws<span class="token punctuation">,</span> cluster_name<span class="token punctuation">,</span> compute_config<span class="token punctuation">)</span>
production_cluster<span class="token punctuation">.</span>wait_for_completion<span class="token punctuation">(</span>show_output<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><p>Now, define the deployment configuration</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>core<span class="token punctuation">.</span>webservice <span class="token keyword">import</span> AksWebservice

classifier_deploy_config <span class="token operator">=</span> AksWebservice<span class="token punctuation">.</span>deploy_configuration<span class="token punctuation">(</span>cpu_cores <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
                                                              memory_gb <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>Note:</strong> To deploy a model to an Azure Function, you do not need to create a deployment configuration.</p> <ol start="4"><li>Deploy the Model</li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>core<span class="token punctuation">.</span>model <span class="token keyword">import</span> Model

service <span class="token operator">=</span> Model<span class="token punctuation">.</span>deploy<span class="token punctuation">(</span>workspace<span class="token operator">=</span>ws<span class="token punctuation">,</span>
                       name <span class="token operator">=</span> <span class="token string">'classifier-service'</span><span class="token punctuation">,</span>
                       models <span class="token operator">=</span> <span class="token punctuation">[</span>classification_model<span class="token punctuation">]</span><span class="token punctuation">,</span>
                       inference_config <span class="token operator">=</span> classifier_inference_config<span class="token punctuation">,</span>
                       deployment_config <span class="token operator">=</span> classifier_deploy_config<span class="token punctuation">,</span>
                       deployment_target <span class="token operator">=</span> production_cluster<span class="token punctuation">)</span>
service<span class="token punctuation">.</span>wait_for_deployment<span class="token punctuation">(</span>show_output <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="consuming-a-service"><a href="#consuming-a-service" class="header-anchor">#</a> Consuming a Service</h3> <p>To consume a service, there are multiple possiblities</p> <ol><li>Use the Azure ML SDK to call a web service through the <code>run</code> method of a <code>WebService</code> object that references the deployed service.</li> <li>Use a REST Endpoint</li></ol> <div class="language-python extra-class"><pre class="language-python"><code>endpoint <span class="token operator">=</span> service<span class="token punctuation">.</span>scoring_uri
<span class="token keyword">print</span><span class="token punctuation">(</span>endpoint<span class="token punctuation">)</span>
</code></pre></div><p><strong>Authentication Methods</strong></p> <ul><li>Key</li> <li>Token (JWT)</li></ul> <p>By default, authentication is disabled for ACI services, and set to key-based authentication for AKS serviceS.</p> <h3 id="troubleshooting-a-web-service"><a href="#troubleshooting-a-web-service" class="header-anchor">#</a> Troubleshooting a Web Service</h3> <h4 id="check-the-service"><a href="#check-the-service" class="header-anchor">#</a> Check the service</h4> <ol><li>Check the state</li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>core<span class="token punctuation">.</span>webservice <span class="token keyword">import</span> AksWebservice

<span class="token comment"># Get the deployed service</span>
service <span class="token operator">=</span> AciWebservice<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'classifier-service'</span><span class="token punctuation">,</span> workspace<span class="token operator">=</span>ws<span class="token punctuation">)</span>

<span class="token comment"># Check its state</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
</code></pre></div><ol start="2"><li>Review Service Logs</li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>get_logs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><ol start="3"><li>Deploy to a Local Container
Deployment and runtime errors can be easier to diagnose by deploying the service as a container in a local Docker instance</li></ol> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>core<span class="token punctuation">.</span>webservice <span class="token keyword">import</span> LocalWebservice

deployment_config <span class="token operator">=</span> LocalWebservice<span class="token punctuation">.</span>deploy_configuration<span class="token punctuation">(</span>port<span class="token operator">=</span><span class="token number">8890</span><span class="token punctuation">)</span>
service <span class="token operator">=</span> Model<span class="token punctuation">.</span>deploy<span class="token punctuation">(</span>ws<span class="token punctuation">,</span> <span class="token string">'test-svc'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>model<span class="token punctuation">]</span><span class="token punctuation">,</span> inference_config<span class="token punctuation">,</span> deployment_config<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>service<span class="token punctuation">.</span>run<span class="token punctuation">(</span>input_data <span class="token operator">=</span> json_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="hyperparameter-tuning"><a href="#hyperparameter-tuning" class="header-anchor">#</a> Hyperparameter Tuning</h2> <p>The set of hyperparameter values tried during hyperparameter tuning is known as the <code>search space</code>.</p> <p>To define a search space for hyperparameter tuning, create a dictionary with the appropriate parameter expression for each named hyperparameter.</p> <p>The specific values used in a hyperparameter tuning run depend on the type of <code>sampling</code> used.</p> <p><strong>Note</strong> Grid sampling can only be employed when all hyperparameters are discrete, and is used to try every possible combination of parameters in the search space</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>train<span class="token punctuation">.</span>hyperdrive <span class="token keyword">import</span> choice<span class="token punctuation">,</span> normal

param_space <span class="token operator">=</span> <span class="token punctuation">{</span>
                 <span class="token string">'--batch_size'</span><span class="token punctuation">:</span> choice<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                 <span class="token string">'--learning_rate'</span><span class="token punctuation">:</span> normal<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
              <span class="token punctuation">}</span>
<span class="token comment"># Grid Sampling</span>
param_sampling <span class="token operator">=</span> GridParameterSampling<span class="token punctuation">(</span>param_space<span class="token punctuation">)</span>

<span class="token comment"># Random Sampling</span>
param_sampling <span class="token operator">=</span> RandomParameterSampling<span class="token punctuation">(</span>param_space<span class="token punctuation">)</span>

<span class="token comment"># Bayesian Sampling</span>
param_sampling <span class="token operator">=</span> BayesianParameterSampling<span class="token punctuation">(</span>param_space<span class="token punctuation">)</span>
</code></pre></div><h3 id="early-termination-policy"><a href="#early-termination-policy" class="header-anchor">#</a> Early Termination Policy</h3> <p>The policy is evaluated at an <code>evaluation_interval</code> you specify, based on each time the target performance metric is logged. You can also set a <code>delay_evaluation</code> parameter to avoid evaluating the policy until a minimum number of iterations have been completed.</p> <p>Policy types:</p> <div class="language- extra-class"><pre><code>1. Bandit: target performance metric underperforms the best run so far by a specified margin
2. Median: where the target performance metric is worse than the median of the running averages for all runs
3. Truncation: cancels the lowest performing X% of runs at each evaluation interval based on the truncation_percentage value you specify for X
</code></pre></div><div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> azureml<span class="token punctuation">.</span>train<span class="token punctuation">.</span>hyperdrive <span class="token keyword">import</span> BanditPolicy

early_termination_policy <span class="token operator">=</span> BanditPolicy<span class="token punctuation">(</span>slack_amount <span class="token operator">=</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
                                        evaluation_interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                                        delay_evaluation<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> azureml<span class="token punctuation">.</span>train<span class="token punctuation">.</span>hyperdrive <span class="token keyword">import</span> MedianStoppingPolicy

early_termination_policy <span class="token operator">=</span> MedianStoppingPolicy<span class="token punctuation">(</span>evaluation_interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                                                delay_evaluation<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token keyword">from</span> azureml<span class="token punctuation">.</span>train<span class="token punctuation">.</span>hyperdrive <span class="token keyword">import</span> TruncationSelectionPolicy

early_termination_policy <span class="token operator">=</span> TruncationSelectionPolicy<span class="token punctuation">(</span>truncation_percentage<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span>
                                                     evaluation_interval<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                                                     delay_evaluation<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="hyperdrive"><a href="#hyperdrive" class="header-anchor">#</a> Hyperdrive</h3> <p>Hyperparameters can be tuned by running a Hyperdrive experiment.</p> <p>Script requirements:</p> <div class="language- extra-class"><pre><code>* Include an argument for each hyperparameter you want to vary.

* Log the target performance metric. This is what enables the hyperdrive run to evaluate the performance of the child runs it initiates, and identify the one that produces the best performing model.
</code></pre></div><p><strong>Configuring and Running a Hyperdrive Experiment</strong>
To prepare the Hyperdrive experiment, you must use a <code>HyperDriveConfig</code> object to configure the experiment run.</p> <h3 id="monitoring-hyperdrives"><a href="#monitoring-hyperdrives" class="header-anchor">#</a> Monitoring Hyperdrives</h3> <p>You can monitor Hyperdrive experiments in Azure Machine Learning studio, or by using the Jupyter Notebooks <code>RunDetails</code> widget.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.03c7e310.js" defer></script><script src="/assets/js/2.13746587.js" defer></script><script src="/assets/js/50.a2925b36.js" defer></script>
  </body>
</html>
