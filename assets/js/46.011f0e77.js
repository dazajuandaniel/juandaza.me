(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{376:function(t,a,s){"use strict";s.r(a);var e=s(42),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"azure-dp-100-day-3"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#azure-dp-100-day-3"}},[t._v("#")]),t._v(" Azure DP-100 Day 3")]),t._v(" "),s("h2",{attrs:{id:"deploying-and-consuming-models"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploying-and-consuming-models"}},[t._v("#")]),t._v(" Deploying and Consuming Models")]),t._v(" "),s("p",[s("code",[t._v("Inferencing")]),t._v(" refers to the use of a trained model to predict labels for new data on which the model has not been trained. In Azure Machine learning, you can create real-time inferencing solutions by deploying a model in a containerized platform such as "),s("code",[t._v("Azure Kubernetes Services (AKS)")]),t._v(".")]),t._v(" "),s("h3",{attrs:{id:"deploying-a-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#deploying-a-service"}},[t._v("#")]),t._v(" Deploying a Service")]),t._v(" "),s("p",[t._v("You can deploy a model as a real-time web service to the following compute targets:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("* local compute\n* an Azure Machine Learning compute instance\n* an Azure Container Instance (ACI)\n* an Azure Kubernetes Service (AKS) cluster\n* an Azure Function\n* an Internet of Things (IoT) module. \n")])])]),s("p",[t._v("Azure Machine Learning uses containers as a deployment mechanism, packaging the model and the code to use it as an image that can be deployed to a container in your chosen compute target.")]),t._v(" "),s("p",[t._v("To Deploy a model:")]),t._v(" "),s("ol",[s("li",[t._v("Register a trained model using the "),s("code",[t._v("register")]),t._v(" method")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Model\n\nclassification_model "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("register"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workspace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ws"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                       model_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'classification_model'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                       model_path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'model.pkl'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# local path")]),t._v("\n                       description"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'A classification model'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Define Inference Configuration")])]),t._v(" "),s("p",[t._v("A model is composed of "),s("code",[t._v("a script to load the model")]),t._v(" and "),s("code",[t._v("an environment")]),t._v(".")]),t._v(" "),s("h4",{attrs:{id:"entry-script"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#entry-script"}},[t._v("#")]),t._v(" Entry Script")]),t._v(" "),s("p",[t._v("The "),s("code",[t._v("entry script")]),t._v(" must contain:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("*init()\n*run(raw_data)\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" json\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" joblib\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" numpy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" np\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Model\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Called when the service is loaded")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("init")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("global")]),t._v(" model\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Get the path to the registered model file and load it")]),t._v("\n    model_path "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_model_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'classification_model'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    model "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" joblib"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("load"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("model_path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Called when a request is received")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("run")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("raw_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Get the input data as a numpy array")]),t._v("\n    data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" np"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("array"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("json"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("loads"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("raw_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Get a prediction from the model")]),t._v("\n    predictions "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Return the predictions as any JSON serializable format")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" predictions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("tolist"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h4",{attrs:{id:"creating-an-environment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#creating-an-environment"}},[t._v("#")]),t._v(" Creating an Environment")]),t._v(" "),s("p",[t._v("It is possible use a "),s("code",[t._v("CondaDependencies")]),t._v(" class to create a default environment, you can then add any other required packages, and then serialize the environment to a string and save it.")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conda_dependencies "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" CondaDependencies\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Add the dependencies for your model")]),t._v("\nmyenv "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" CondaDependencies"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nmyenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("add_conda_package"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scikit-learn"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Save the environment config as a .yml file")]),t._v("\nenv_file "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'service_files/env.yml'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("env_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"w"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    f"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("write"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("myenv"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("serialize_to_string"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Saved dependency info in"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" env_file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Then both script and config file can be added into one script:")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" InferenceConfig\n\nclassifier_inference_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" InferenceConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("runtime"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"python"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                              source_directory "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'service_files'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                              entry_script"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"score.py"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                              conda_file"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"env.yml"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("Define a Deployment Configuration")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compute "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ComputeTarget"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" AksCompute\n\ncluster_name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'aks-cluster'")]),t._v("\ncompute_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AksCompute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("provisioning_configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("location"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eastus'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nproduction_cluster "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ComputeTarget"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("create"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ws"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cluster_name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" compute_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nproduction_cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_completion"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("show_output"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Now, define the deployment configuration")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webservice "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" AksWebservice\n\nclassifier_deploy_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AksWebservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deploy_configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cpu_cores "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                                              memory_gb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("Note:")]),t._v(" To deploy a model to an Azure Function, you do not need to create a deployment configuration.")]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("Deploy the Model")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("model "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Model\n\nservice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workspace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ws"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                       name "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'classifier-service'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                       models "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("classification_model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                       inference_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" classifier_inference_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                       deployment_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" classifier_deploy_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                       deployment_target "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" production_cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("wait_for_deployment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("show_output "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"consuming-a-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#consuming-a-service"}},[t._v("#")]),t._v(" Consuming a Service")]),t._v(" "),s("p",[t._v("To consume a service, there are multiple possiblities")]),t._v(" "),s("ol",[s("li",[t._v("Use the Azure ML SDK to call a web service through the "),s("code",[t._v("run")]),t._v(" method of a "),s("code",[t._v("WebService")]),t._v(" object that references the deployed service.")]),t._v(" "),s("li",[t._v("Use a REST Endpoint")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("endpoint "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("scoring_uri\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("endpoint"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("Authentication Methods")])]),t._v(" "),s("ul",[s("li",[t._v("Key")]),t._v(" "),s("li",[t._v("Token (JWT)")])]),t._v(" "),s("p",[t._v("By default, authentication is disabled for ACI services, and set to key-based authentication for AKS serviceS.")]),t._v(" "),s("h3",{attrs:{id:"troubleshooting-a-web-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting-a-web-service"}},[t._v("#")]),t._v(" Troubleshooting a Web Service")]),t._v(" "),s("h4",{attrs:{id:"check-the-service"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#check-the-service"}},[t._v("#")]),t._v(" Check the service")]),t._v(" "),s("ol",[s("li",[t._v("Check the state")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webservice "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" AksWebservice\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Get the deployed service")]),t._v("\nservice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" AciWebservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'classifier-service'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" workspace"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("ws"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Check its state")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("state"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"2"}},[s("li",[t._v("Review Service Logs")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get_logs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("Deploy to a Local Container\nDeployment and runtime errors can be easier to diagnose by deploying the service as a container in a local Docker instance")])]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("core"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("webservice "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" LocalWebservice\n\ndeployment_config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" LocalWebservice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deploy_configuration"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("port"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8890")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nservice "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deploy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ws"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test-svc'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("model"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" inference_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" deployment_config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("service"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("run"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("input_data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json_data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h2",{attrs:{id:"hyperparameter-tuning"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hyperparameter-tuning"}},[t._v("#")]),t._v(" Hyperparameter Tuning")]),t._v(" "),s("p",[t._v("The set of hyperparameter values tried during hyperparameter tuning is known as the "),s("code",[t._v("search space")]),t._v(".")]),t._v(" "),s("p",[t._v("To define a search space for hyperparameter tuning, create a dictionary with the appropriate parameter expression for each named hyperparameter.")]),t._v(" "),s("p",[t._v("The specific values used in a hyperparameter tuning run depend on the type of "),s("code",[t._v("sampling")]),t._v(" used.")]),t._v(" "),s("p",[s("strong",[t._v("Note")]),t._v(" Grid sampling can only be employed when all hyperparameters are discrete, and is used to try every possible combination of parameters in the search space")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("train"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hyperdrive "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" choice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" normal\n\nparam_space "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--batch_size'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" choice"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                 "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'--learning_rate'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" normal"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Grid Sampling")]),t._v("\nparam_sampling "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" GridParameterSampling"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param_space"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Random Sampling")]),t._v("\nparam_sampling "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" RandomParameterSampling"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param_space"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Bayesian Sampling")]),t._v("\nparam_sampling "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BayesianParameterSampling"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param_space"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"early-termination-policy"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#early-termination-policy"}},[t._v("#")]),t._v(" Early Termination Policy")]),t._v(" "),s("p",[t._v("The policy is evaluated at an "),s("code",[t._v("evaluation_interval")]),t._v(" you specify, based on each time the target performance metric is logged. You can also set a "),s("code",[t._v("delay_evaluation")]),t._v(" parameter to avoid evaluating the policy until a minimum number of iterations have been completed.")]),t._v(" "),s("p",[t._v("Policy types:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("1. Bandit: target performance metric underperforms the best run so far by a specified margin\n2. Median: where the target performance metric is worse than the median of the running averages for all runs\n3. Truncation: cancels the lowest performing X% of runs at each evaluation interval based on the truncation_percentage value you specify for X\n")])])]),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("train"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hyperdrive "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" BanditPolicy\n\nearly_termination_policy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" BanditPolicy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("slack_amount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                        evaluation_interval"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                        delay_evaluation"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("train"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hyperdrive "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" MedianStoppingPolicy\n\nearly_termination_policy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" MedianStoppingPolicy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("evaluation_interval"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                                delay_evaluation"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" azureml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("train"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hyperdrive "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" TruncationSelectionPolicy\n\nearly_termination_policy "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" TruncationSelectionPolicy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("truncation_percentage"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                                     evaluation_interval"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                                                     delay_evaluation"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"hyperdrive"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#hyperdrive"}},[t._v("#")]),t._v(" Hyperdrive")]),t._v(" "),s("p",[t._v("Hyperparameters can be tuned by running a Hyperdrive experiment.")]),t._v(" "),s("p",[t._v("Script requirements:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("* Include an argument for each hyperparameter you want to vary.\n\n* Log the target performance metric. This is what enables the hyperdrive run to evaluate the performance of the child runs it initiates, and identify the one that produces the best performing model.\n")])])]),s("p",[s("strong",[t._v("Configuring and Running a Hyperdrive Experiment")]),t._v("\nTo prepare the Hyperdrive experiment, you must use a "),s("code",[t._v("HyperDriveConfig")]),t._v(" object to configure the experiment run.")]),t._v(" "),s("h3",{attrs:{id:"monitoring-hyperdrives"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#monitoring-hyperdrives"}},[t._v("#")]),t._v(" Monitoring Hyperdrives")]),t._v(" "),s("p",[t._v("You can monitor Hyperdrive experiments in Azure Machine Learning studio, or by using the Jupyter Notebooks "),s("code",[t._v("RunDetails")]),t._v(" widget.")])])}),[],!1,null,null,null);a.default=n.exports}}]);