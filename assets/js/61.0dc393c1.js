(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{419:function(t,e,a){"use strict";a.r(e);var s=a(42),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[t._v("#")]),t._v(" Docker")]),t._v(" "),a("p",[t._v("Learnings from ACloud Guru's Video Guide")]),t._v(" "),a("h2",{attrs:{id:"vms-vs-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vms-vs-docker"}},[t._v("#")]),t._v(" VMs vs Docker")]),t._v(" "),a("p",[t._v("Dockers are not VMs -> They are closer to isolated processes")]),t._v(" "),a("ul",[a("li",[a("em",[t._v("VM")]),t._v("-> Isolate Systems")]),t._v(" "),a("li",[a("em",[t._v("Docker")]),t._v(" -> Isolate Process")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("Virtual Machines")])]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}},[a("strong",[t._v("Docker Containers")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("Applications")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("Bins/Libs")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Applications")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("Multiple Guest OS")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Bins/Libs")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("Hypervisor (Type 1 or 2)")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Docker Daemon")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("Host OS")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Host OS")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[t._v("Infrastructure")]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Infrastructure")])])])]),t._v(" "),a("h3",{attrs:{id:"when-to-use-docker-vms"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#when-to-use-docker-vms"}},[t._v("#")]),t._v(" When to Use Docker/VMs?")]),t._v(" "),a("p",[t._v("VMs -> For testing environments or for testing things that are outside the scope of Docker (like a Firewall config since it's done on the OS configuration")]),t._v(" "),a("p",[t._v("Docker -> A component of a web application (Isolation of processes)")]),t._v(" "),a("h3",{attrs:{id:"docker-architecture"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-architecture"}},[t._v("#")]),t._v(" Docker Architecture")]),t._v(" "),a("p",[t._v("Docker Daemon -> Rest API -> Docker CLI\nClient (Runs commands) -> Docker Host (Runs the daemon) -> Registry")]),t._v(" "),a("h2",{attrs:{id:"docker-image"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-image"}},[t._v("#")]),t._v(" Docker Image")]),t._v(" "),a("p",[t._v("Features:")]),t._v(" "),a("ul",[a("li",[t._v("Files system + Parameters (things needed to run an application)")]),t._v(" "),a("li",[t._v("Does not have state and doesn't change")]),t._v(" "),a("li",[t._v("Gets downloaded, build and run")]),t._v(" "),a("li",[t._v("Running an Image == Container")]),t._v(" "),a("li",[t._v("Docker Image -> Class and Container -> Instance of class")]),t._v(" "),a("li",[t._v("Result of running a series of steps")]),t._v(" "),a("li",[t._v("One image, many containers")]),t._v(" "),a("li",[t._v("Containers are immutable")])]),t._v(" "),a("p",[a("strong",[t._v("Example of Non-changing State (Immutable Container)")])]),t._v(" "),a("p",[t._v("Run  the following command")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v(" docker run -it alpine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sh")]),t._v("\n")])])]),a("p",[t._v("After it has started, create a file and run "),a("code",[t._v("exit")]),t._v(". The run the command above again. Notice that the file does not exist.")]),t._v(" "),a("p",[t._v("Even if we run multiple docker containers, the files in one container will not be seen in the other container.")]),t._v(" "),a("h2",{attrs:{id:"docker-hub-docker-registry"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-hub-docker-registry"}},[t._v("#")]),t._v(" Docker Hub (Docker Registry)")]),t._v(" "),a("p",[t._v("Like Github for Docker Images")]),t._v(" "),a("p",[t._v("Official vs Public :")]),t._v(" "),a("ul",[a("li",[t._v("Official doesn't require full namespace")])]),t._v(" "),a("h2",{attrs:{id:"docker-build-process"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-build-process"}},[t._v("#")]),t._v(" Docker Build Process")]),t._v(" "),a("h3",{attrs:{id:"docker-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-file"}},[t._v("#")]),t._v(" Docker File")]),t._v(" "),a("p",[t._v("Has build steps for your application (each actionable step becomes a layer)")]),t._v(" "),a("h3",{attrs:{id:"docker-images"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-images"}},[t._v("#")]),t._v(" Docker Images")]),t._v(" "),a("p",[t._v("Are composed of "),a("strong",[t._v("multiple layers")]),t._v(" (each layer are self-contained files) and a docker images is a result of stacking all layers. Only changed layers are updated.")]),t._v(" "),a("h2",{attrs:{id:"docker-file-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-file-2"}},[t._v("#")]),t._v(" Docker File")]),t._v(" "),a("h3",{attrs:{id:"docker-commands-flags"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-commands-flags"}},[t._v("#")]),t._v(" Docker Commands/Flags")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"center"}},[t._v("Command/Flag")]),t._v(" "),a("th",{staticStyle:{"text-align":"center"}})])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("FROM <image>:<tag>")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Allows to import base image to use")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("RUN")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Allows to run any script (Shell)")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("WORKDIR")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Pass a directory path. All following instructions are run from this path")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("COPY <src> <dest>")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Similar to CP in Linux")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("LABEL <key>=<value>")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Allows to add metadata - Each layer creates a new layer")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("CMD")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Defines default command when docker image gets started (Executed when it's ran not built - can be overwritten using flags")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("VOLUME")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Indicates to Docker to expose a path to the container")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("-it")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Enable Docker to handle Unix Symbols and Terminal Colors and sets container to being interactive")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("-p")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Port flag "),a("code",[t._v("<bind on docker host>:<port on container>")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("-e")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Pass Environment Variable")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("--rm")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Removes container automatically after it's being stopped")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("-d")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Runs container in detached mode")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("--restart")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Indicates when to restart e.g. "),a("code",[t._v("on-failure")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"center"}},[a("code",[t._v("-v")])]),t._v(" "),a("td",{staticStyle:{"text-align":"center"}},[t._v("Mount a volume "),a("code",[t._v("<local directory>:<directory_in_container>")])])])])]),t._v(" "),a("p",[a("strong",[t._v("Notes")])]),t._v(" "),a("ul",[a("li",[t._v("The first non comment line in the file must be the "),a("code",[t._v("FROM")])]),t._v(" "),a("li",[t._v("Cannot copy or look at files above the docker file.")])]),t._v(" "),a("div",{staticClass:"language-docker extra-class"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" python"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("2.7"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("alpine\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" mkdir /app\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WORKDIR")]),t._v(" /app\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" requirements.txt requirements.txt\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("RUN")]),t._v(" pip install "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("r requirements.txt\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("COPY")]),t._v(" . .\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("LABEL")]),t._v(" mantainer="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Juan Daza <email@email.com>"')]),t._v("\\\n\t  version="),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1.0"')]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("VOLUME")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app/public"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t  \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CMD")]),t._v(" flask run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("host=0.0.0.0 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("port=5000\n")])])]),a("p",[t._v("Build the image")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("docker image build -t "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("tag_here"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(".")]),t._v("\n\ndocker container run -it -p "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(":5000 -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("FLASK_APP")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("app.py "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("FLASK_DEBUG")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" -v "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("location"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":/app tag_here \n")])])]),a("p",[t._v("Remove/Stop all containers")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("docker stop "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -a -q"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$(")]),t._v("docker "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ps")]),t._v(" -a -q"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v(")")])]),t._v("\n")])])]),a("p",[t._v("See logs command")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("docker container log "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("id/name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -f\n")])])]),a("p",[t._v("Realtime metrics")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("docker container stats\n")])])]),a("h4",{attrs:{id:"docker-named-volumes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-named-volumes"}},[t._v("#")]),t._v(" Docker Named Volumes")]),t._v(" "),a("p",[t._v("Allow to supply a name instead of file path and Docker will manage it in its special volumes directory. "),a("strong",[t._v("Perfect for databases")])]),t._v(" "),a("p",[t._v("Create a named volume:")]),t._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[t._v("docker volume create "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("volume_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("volume_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("h2",{attrs:{id:"docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose"}},[t._v("#")]),t._v(" Docker Compose")]),t._v(" "),a("div",{staticClass:"language-docker extra-class"},[a("pre",{pre:!0,attrs:{class:"language-docker"}},[a("code",[t._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'3'")]),t._v("\n\nservices"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'redis:3.2-alpine'")]),t._v("\n    ports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'6379:6379'")]),t._v("\n    volumes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'redis:/data'")]),t._v("\n\n  web"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" .\n    depends_on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'redis'")]),t._v("\n    env_file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.env'")]),t._v("\n    ports"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'5000:5000'")]),t._v("\n    volumes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.:/app'")]),t._v("\n\nvolumes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"other-docker-concepts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#other-docker-concepts"}},[t._v("#")]),t._v(" Other Docker Concepts")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.docker.com/blog/advanced-dockerfiles-faster-builds-and-smaller-images-using-buildkit-and-multistage-builds/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Multi Stage Builds"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=n.exports}}]);